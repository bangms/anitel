package anitel.model;

import java.sql.Connection;
import java.sql.PreparedStatement;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.sql.DataSource;

public class MemberDAO {
	private static MemberDAO instance = new MemberDAO();
	private MemberDAO() {}
	public static MemberDAO getInstance() { return instance; }
	
	// 커넥션 메서드 : 내부에서만 사용할거라 private 접근 제어자
	private Connection getConnection() throws Exception {
		Context ctx = new InitialContext();
		Context env = (Context)ctx.lookup("java:comp/env");
		DataSource ds = (DataSource)env.lookup("jdbc/orcl");
		return ds.getConnection();
	}
	
	// 회원가입 메서드 (member 테이블에 입력)
	public void insertMember(MemberDTO member) {
		Connection conn = null;
		PreparedStatement  pstmt = null;
		
		try {
			conn = getConnection();
			// DB에 작성되어있는 순서대로 작성하여야 함 (컬럼명 작성 안했기 때문에)
			String sql = "insert into member values(?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
			pstmt = conn.prepareStatement(sql);
			pstmt.setString(1, member.getId());
			pstmt.setString(2, member.getMember_pw());
			pstmt.setString(3, member.getMember_name());
			pstmt.setString(4, member.getMember_phone());
			pstmt.setString(5, member.getMember_email());
			pstmt.setString(6, member.getHotel_name());
			pstmt.setString(7, member.getHotel_owner());
			pstmt.setString(8, member.getHotel_add());
			pstmt.setString(9, member.getHotel_phone());
			pstmt.setInt(10, member.getMember_approved());
			pstmt.setString(11, member.getHotel_intro());
			pstmt.setString(12, member.getHotel_area());
			pstmt.setString(13, member.getHold_reason());
			pstmt.setString(14, member.getReg_num());
			
			int result = pstmt.executeUpdate();
			System.out.println(result);
			
		}catch(Exception e) {
			e.printStackTrace();
		}finally {
			if(pstmt != null) try { pstmt.close(); } catch(Exception e) { e.printStackTrace(); }
			if(conn != null) try { conn.close(); } catch(Exception e) { e.printStackTrace(); }
		}
	}
	
	// 회원가입 메서드 (room 테이블에 입력)
	public void insertRoom(RoomDTO room) {
		Connection conn = null;
		PreparedStatement  pstmt = null;
		
		try {
			conn = getConnection();
			// DB에 작성되어있는 순서대로 작성하여야 함 (컬럼명 작성 안했기 때문에)
			String sql = "insert into room values(?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
			pstmt = conn.prepareStatement(sql);
			pstmt.setInt(1, room.getRoom_num());
			pstmt.setString(2, room.get);
			pstmt.setString(3, room.get);
			pstmt.setInt(4, room.get);
			pstmt.setString(5, room.get);
			pstmt.setString(6, room.get);
			pstmt.setInt(7, room.get);
			pstmt.setInt(8, room.get);
			pstmt.setInt(9, room.get);
			pstmt.setInt(10, room.get);
			pstmt.setInt(11, room.get);
			pstmt.setInt(12, room.get);
			pstmt.setInt(13, room.get);
			pstmt.setString(14, room.get);
			
			int result = pstmt.executeUpdate();
			System.out.println(result);
			
		}catch(Exception e) {
			e.printStackTrace();
		}finally {
			if(pstmt != null) try { pstmt.close(); } catch(Exception e) { e.printStackTrace(); }
			if(conn != null) try { conn.close(); } catch(Exception e) { e.printStackTrace(); }
		}
	}
}
